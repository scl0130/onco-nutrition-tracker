<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profile | OncoNutrition Tracker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body class="app-shell" data-page="profile">
    <header class="top-nav">
      <a class="brand" href="./index.html">OncoNutrition Tracker</a>
      <nav aria-label="Primary navigation">
        <a class="nav-link" href="./index.html">Dashboard</a>
        <a class="nav-link" href="./tracker.html">Track Food</a>
        <a class="nav-link is-active" href="./profile.html" aria-current="page">Profile</a>
      </nav>
      <div class="auth-inline">
        <span id="authUserBadge" class="muted">Guest mode</span>
        <button type="button" id="logoutButton" class="secondary hidden">Log out</button>
      </div>
    </header>

    <main class="page">
      <section class="card panel" id="account">
        <div class="auth-head">
          <div>
            <h2>Account (optional)</h2>
            <p class="muted">Use guest mode immediately, or sign in securely to keep your data under your account.</p>
          </div>
          <div class="inline-actions">
            <button type="button" id="continueGuestButton" class="secondary">Continue as guest</button>
          </div>
        </div>
        <p id="authModeStatus" class="muted">Guest mode active. Data stays on this browser.</p>
        <details class="auth-config">
          <summary>Secure auth configuration (Supabase)</summary>
          <div class="grid">
            <label>Supabase URL <input type="url" id="supabaseUrlInput" placeholder="https://your-project.supabase.co" /></label>
            <label>Supabase anon key <input type="password" id="supabaseAnonKeyInput" placeholder="sb_publishable_..." /></label>
            <div class="inline-actions">
              <button type="button" id="saveSupabaseConfig" class="secondary">Save auth config</button>
              <button type="button" id="clearSupabaseConfig" class="secondary">Clear config</button>
            </div>
            <p id="supabaseConfigStatus" class="muted" aria-live="polite"></p>
          </div>
        </details>
        <div class="auth-grid" id="authFormsWrap">
          <form id="signupForm" class="grid">
            <h3>Create account</h3>
            <label>Email <input type="email" id="signupEmail" required /></label>
            <label>Password <input type="password" id="signupPassword" minlength="6" required /></label>
            <button type="submit">Sign up</button>
          </form>
          <form id="loginForm" class="grid">
            <h3>Log in</h3>
            <label>Email <input type="email" id="loginEmail" required /></label>
            <label>Password <input type="password" id="loginPassword" required /></label>
            <button type="submit" class="secondary">Log in</button>
          </form>
        </div>
        <p id="authStatus" class="muted" aria-live="polite"></p>
      </section>

      <section class="card panel">
        <h1>Profile Setup</h1>
        <p class="muted">Set up patient context before interpreting dashboard status.</p>
      </section>

      <form id="profileSetupForm" class="grid">
        <section class="card panel">
          <h2>Section 1: Basic Information</h2>
          <div class="grid form-grid">
            <label>Age <input type="number" min="18" max="120" id="profileAge" required /></label>
            <label>Sex
              <select id="profileSex" required>
                <option value="female">Female</option>
                <option value="male">Male</option>
              </select>
            </label>
            <label>Height (cm) <input type="number" min="100" max="250" id="profileHeightCm" required /></label>
            <label>Weight (kg) <input type="number" min="30" max="300" step="0.1" id="profileWeightKg" required /></label>
            <label>Activity level
              <select id="profileActivity" required>
                <option value="1.2">Low / mostly sedentary</option>
                <option value="1.375">Light activity</option>
                <option value="1.55">Moderate activity</option>
                <option value="1.725">High activity</option>
              </select>
            </label>
            <label>Recent unintentional weight change
              <select id="profileWeightLoss" required>
                <option value="none">None</option>
                <option value="mild">Up to 5%</option>
                <option value="moderate">5-10%</option>
                <option value="severe">More than 10%</option>
              </select>
            </label>
            <label>Appetite / intake this week
              <select id="profileAppetite" required>
                <option value="normal">Normal</option>
                <option value="reduced">Reduced</option>
                <option value="very_low">Very low</option>
              </select>
            </label>
          </div>
        </section>

        <section class="card panel">
          <h2>Section 2: Cancer and Treatment</h2>
          <div class="grid form-grid">
            <label>Cancer type <select id="cancerSelect" required></select></label>
            <label>Treatment type
              <select id="profileTreatmentType" required>
                <option value="chemotherapy">Chemotherapy</option>
                <option value="radiation">Radiation</option>
                <option value="surgery">Surgery / perioperative</option>
                <option value="immunotherapy">Immunotherapy</option>
                <option value="targeted">Targeted therapy</option>
                <option value="none">None currently</option>
              </select>
            </label>
            <label>Treatment mode
              <select id="profileTreatmentMode" required>
                <option value="on">On treatment</option>
                <option value="off">Off treatment</option>
                <option value="normal">Normal / no active treatment</option>
              </select>
            </label>
            <fieldset id="dialysisField" class="hidden">
              <legend>Dialysis status (Kidney only)</legend>
              <label><input type="radio" name="dialysisStatus" value="off" checked /> Off dialysis</label>
              <label><input type="radio" name="dialysisStatus" value="on" /> On dialysis</label>
            </fieldset>
            <label>Treatment cycle length (days)
              <input type="number" min="1" max="60" id="profileCycleLengthDays" value="21" />
            </label>
            <label>Current cycle day
              <input type="number" min="1" max="60" id="profileCycleDay" value="1" />
            </label>
            <label>Last treatment date
              <input type="date" id="profileLastTreatmentDate" />
            </label>
            <label>Next treatment date
              <input type="date" id="profileNextTreatmentDate" />
            </label>
          </div>
        </section>

        <section class="card panel">
          <h2>Section 3: Symptoms</h2>
          <p class="muted">Severity scale: 0 none, 1 mild, 2 moderate, 3 severe.</p>
          <div id="symptomForm" class="grid form-grid severity-grid">
            <label>Nausea
              <select data-symptom-key="nausea_severity"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option></select>
            </label>
            <label>Vomiting
              <select data-symptom-key="vomiting_severity"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option></select>
            </label>
            <label>Diarrhea
              <select data-symptom-key="diarrhea_severity"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option></select>
            </label>
            <label>Constipation
              <select data-symptom-key="constipation_severity"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option></select>
            </label>
            <label>Mucositis / mouth sores
              <select data-symptom-key="mucositis_severity"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option></select>
            </label>
            <label>Taste changes
              <select data-symptom-key="taste_change_severity"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option></select>
            </label>
            <label>Dry mouth
              <select data-symptom-key="dry_mouth_severity"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option></select>
            </label>
            <label>Difficulty swallowing
              <select data-symptom-key="difficulty_swallowing_severity"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option></select>
            </label>
            <label>Appetite loss
              <select data-symptom-key="appetite_loss_severity"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option></select>
            </label>
            <label>Early satiety
              <select data-symptom-key="early_satiety_severity"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option></select>
            </label>
            <label>Fatigue
              <select data-symptom-key="fatigue_severity"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option></select>
            </label>
            <label>Bloating
              <select data-symptom-key="bloating_severity"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option></select>
            </label>
            <label>Greasy stools
              <select data-symptom-key="greasy_stools_severity"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option></select>
            </label>
            <label>Floating stools
              <select data-symptom-key="floating_stools_severity"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option></select>
            </label>
            <label>Pain affecting eating
              <select data-symptom-key="pain_severity"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option></select>
            </label>
          </div>
        </section>

        <section class="card panel">
          <h2>Weight Tracking</h2>
          <p class="muted">Log daily weights from the Dashboard under the Weight Trend panel.</p>
        </section>

        <section class="card panel">
          <h2>Section 4: Save</h2>
          <button type="submit" id="saveProfileButton">Save Profile</button>
          <p id="profileStatus" class="muted" aria-live="polite"></p>
        </section>
      </form>
    </main>

    <footer class="app-footer">
      <p>Educational only, not medical advice. If you have rapid weight loss, dehydration, inability to eat or drink, fever, or worsening symptoms, contact your oncology team or urgent care.</p>
    </footer>

    <script src="./sourcesRegistry.js"></script>
    <script src="./recommendations.js"></script>
    <script src="./src/data/recommendationsCatalog.js"></script>
    <script src="./src/logic/deriveFlags.js"></script>
    <script src="./src/logic/getRecommendationsForUser.js"></script>
    <script src="./recommendationValidator.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="./app-main.js"></script>
  </body>
</html>
